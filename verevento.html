<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Eventos</title>
</head>
<body>
  <h1>Lista de eventos</h1>

  <a href="añadir_evento.html">➕ Nuevo Evento</a><br /><br />

  <table border="1" cellpadding="8">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Fecha</th>
        <th>Ubicación</th>
        <th>Categoría</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="tabla-eventos">
      <!-- Aquí se insertan los eventos dinámicamente -->
    </tbody>
  </table>

  <script>
    // Cargar eventos dinámicamente desde EventController.php
    function cargarEventos() {
      fetch('EventController.php?action=list')
        .then(response => response.json())
        .then(eventos => {
          const tbody = document.getElementById('tabla-eventos');
          tbody.innerHTML = ""; // Limpiar tabla antes de cargar

          eventos.forEach(e => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${e.nombre_evento}</td>
              <td>${e.fecha} ${e.hora}</td>
              <td>${e.ubicacion}</td>
              <td>${e.categoria}</td>
              <td>
                <a href="editar_evento.html?id=${e.id_evento}">Editar</a> |
                <button onclick="eliminarEvento(${e.id_evento})">Eliminar</button>
              </td>
            `;
            tbody.appendChild(row);
          });
        });
    }

    // Función para eliminar eventos
    function eliminarEvento(id_evento) {
      if (confirm('¿Eliminar evento?')) {
        fetch('EventController.php', {
          method: 'POST',
          body: new URLSearchParams({
            action: "delete",
            id_evento: id_evento
          })
        })
        .then(response => response.text())
        .then(() => {
          alert("Evento eliminado exitosamente");
          cargarEventos();
        })
        .catch(error => alert("Error al eliminar el evento"));
      }
    }

    // Cargar eventos al inicio
    document.addEventListener("DOMContentLoaded", cargarEventos);
  </script>
</body>
</html>
